###################
## HTTP  SECTION ##
###################

server {
	listen       3579;
	server_name  static.project.my.home;
	root /srv/project.my.home/static;

    location '/.well-known/acme-challenge' {
        default_type "text/plain";
        root        /srv;
    }
    location /    {
        add_header Access-Control-Allow-Origin "$http_origin";
    }
	index index.html;
}

server {
	listen       3579;
	server_name  service.project.my.home;

	client_max_body_size 40M;
	index service.php;
	root /srv/project.my.home/service/;

    if ($request_method = OPTIONS) { return 204; }

    location '/.well-known/acme-challenge' {
        default_type "text/plain";
        root        /srv;
    }
	location /
	{
		include        fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_index  service.php;
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}
}

server {
	listen       3579;
	server_name  project.my.home;
	root /srv/project.my.home;


    location '/.well-known/acme-challenge' {
        default_type "text/plain";
        root        /srv;
    }
	location / {
		include /etc/nginx/fastcgi_params;
	        fastcgi_intercept_errors on;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_param 	SCRIPT_FILENAME /srv/project.my.home/main.php;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}

	location /static
	{
        alias /srv/project.my.home/static;
	}
	location /service
	{
		include        fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_index  service.php;
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}
}

server {
	listen       80;
	server_name  *.project.my.home;
	root /srv/project.my.home;
    index main.php;


    location '/.well-known/acme-challenge' {
        default_type "text/plain";
        root        /srv;
    }
	location / {
		include /etc/nginx/fastcgi_params;
	        fastcgi_intercept_errors on;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_param SCRIPT_FILENAME /srv/project.my.home/main.php;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}

	location /static
	{
        alias /srv/project.my.home/static;
	}
	location /service
	{
		include        fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_index  service.php;
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock; 
	}
}


###################
## HTTPS SECTION ##
###################

server {
	listen       443;
	server_name  static.project.my.home;
	root /srv/project.my.home/static;

#	ssl    on;
#	ssl_certificate /etc/letsencrypt/live/suitespace.corp-0004/fullchain.pem; # managed by Certbot
#	ssl_certificate_key /etc/letsencrypt/live/suitespace.corp-0004/privkey.pem; # managed by Certbot


	location /	{
		add_header Access-Control-Allow-Origin "$http_origin";
		error_page 403 https://static.project.my.home/img/404.png;
	}
	index index.html;


}

server {
	listen	   443;
	server_name  service.project.my.home;
	client_max_body_size 40M;

#	ssl	on;
#	ssl_certificate /etc/letsencrypt/live/suitespace.corp-0004/fullchain.pem; # managed by Certbot
#	ssl_certificate_key /etc/letsencrypt/live/suitespace.corp-0004/privkey.pem; # managed by Certbot


	index service.php;
	root /srv/project.my.home/service/;

	if ($request_method = OPTIONS) { return 204; }

	location '/.well-known/acme-challenge' {
		default_type "text/plain";
		root		/srv;
	}
	location ~ \.php
	{
		include		fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_index  index.php;
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}
}

server {
	listen	   443;
	server_name  project.my.home ;
	root /srv/project.my.home;

#	ssl	on;
#	ssl_certificate /etc/letsencrypt/live/suitespace.corp-0005/fullchain.pem; # managed by Certbot
#	ssl_certificate_key /etc/letsencrypt/live/suitespace.corp-0005/privkey.pem; # managed by Certbot

	location / {
		include /etc/nginx/fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_param	ORIGIN_DOMAIN  project.my.home;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_param SCRIPT_FILENAME /srv/project.my.home/main.php;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}

	location /__static
	{
		alias /srv/project.my.home/static;
	}
	location /__api
	{
		root /srv/project.my.home/service;
		include		fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_index  service.php;
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}
}

server {
	listen	   443;
	server_name  *.project.my.home;
	root /srv/project.my.home;
	index main.php;

#	ssl	on;
#	ssl_certificate /etc/letsencrypt/live/suitespace.corp-0004/fullchain.pem; # managed by Certbot
#	ssl_certificate_key /etc/letsencrypt/live/suitespace.corp-0004/privkey.pem; # managed by Certbot

	location / {
		include /etc/nginx/fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_param	ORIGIN_DOMAIN  suitespace.corp;
		fastcgi_param	SCRIPT_NAME  $document_root$fastcgi_script_name;
#		fastcgi_param	SCRIPT_NAME $request_filename;
		fastcgi_param	SCRIPT_FILENAME /srv/project.my.home/main.php;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}

	location /__static
	{
		alias /srv/project.my.home/static;
	}
	location /__api
	{
		root /srv/project.my.home/service;
		include		fastcgi_params;
		fastcgi_intercept_errors on;
		fastcgi_index  service.php;
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		fastcgi_param  SCRIPT_NAME  $document_root$fastcgi_script_name;
		fastcgi_pass   unix:/var/run/php/project.my.home.sock;
	}
}
